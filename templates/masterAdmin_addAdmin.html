{% extends "base.html" %}

{% block title %}ADD ADMINISTRATORS{% endblock %}

{% block content %}
<nav class="navbar p-2">
    <div class="container">
        <div class="d-flex align-items-center w-100">
            <img src="/static/images/2.png" width="50px" class="me-2" />
            <h5 class="navbar-brand mb-0">RAND REFINERY</h5>

            <!-- Sidebar Toggle Button (only on small screens) -->
            <button id="sidebarToggle" class="btn btn-outline-secondary d-lg-none ms-auto" type="button">
                <i class="fas fa-bars"></i> Menu
            </button>

            <!-- Desktop Menu (hidden on small screens) -->
            <div class="d-none d-lg-flex gap-2 ms-auto">
                <a href="{{ url_for('master_add') }}" class="btn btn-secondary btn-sm my-1">
                    <i class="fas fa-user-plus me-2"></i>ASSIGN ADMINISTRATORS
                </a>
                <a href="{{ url_for('master_remove') }}" class="btn btn-sm my-1" data-bs-toggle="tooltip" title="Remove administrators">
                    <i class="fas fa-user-minus me-2"></i>REMOVE ADMINISTRATORS
                </a>
                <a href="{{ url_for('master_view') }}" class="btn btn-sm my-1">
                    <i class="fas fa-users me-2"></i>VIEW ADMINISTRATORS
                </a>
                <a href="{{ url_for('submit_location') }}" class="btn btn-sm my-1 ms-auto">
                    <i class="fas fa-map-marker-alt me-2"></i>ADD LOCATION
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-sm my-1 ms-auto">
                    <i class="fas fa-right-from-bracket me-2"></i> LOGOUT
                </a>
            </div>
        </div>
    </div>
</nav>

<!-- Sidebar Content (for small screens) -->
<div class="sidebar-content p-3">
    <ul class="list-unstyled">
        <li><a href="{{ url_for('master_add') }}" class="btn btn-secondary btn-sm my-1">
            <i class="fas fa-user-plus me-2"></i>ASSIGN ADMINISTRATORS
        </a></li>
        <li><a href="{{ url_for('master_remove') }}" class="btn btn-sm my-1" data-bs-toggle="tooltip" title="Remove administrators">
            <i class="fas fa-user-minus me-2"></i>REMOVE ADMINISTRATORS
        </a></li>
        <li><a href="{{ url_for('master_view') }}" class="btn btn-sm my-1">
            <i class="fas fa-users me-2"></i>VIEW ADMINISTRATORS
        </a></li>
        <li><a href="{{ url_for('submit_location') }}" class="btn btn-sm my-1 ms-auto">
            <i class="fas fa-map-marker-alt me-2"></i>ADD LOCATION
        </a></li>
        <li><a href="{{ url_for('logout') }}" class="btn btn-sm my-1 ms-auto">
            <i class="fas fa-right-from-bracket me-2"></i> LOGOUT
        </a></li>
    </ul>
</div>

<!-- Main Container -->
<div class="container col-12 col-md-10 col-lg-12 mt-4">
    <div class="d-flex flex-column flex-md-row align-items-center justify-content-between brand_images text-center text-md-start">
        <h2 class="my-3">Welcome back, {{ user.name if user else '' }}</h2>
        <img src="/static/images/freepik.png" width="150px" class="ms-md-auto mt-3 mt-md-0" />
    </div>

    <h2 class="text-center my-3">ASSIGN ADMINISTRATOR</h2>

    <div class="p-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div id="flash-message-container">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}" role="alert">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <form class="form-control" action="/master_add" method="POST">
            <!-- Section Select -->
            <div class="mb-3">
                <label class="form-label">Select Section</label>
                <select class="form-select" name="section" id="section">
                    <option value="" disabled selected>-- Select Section --</option>
                    {% for item in plant_section %}
                        <option value="{{ item.plant_section | upper }}">{{ item.plant_section | upper }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Admin Checkbox List -->
            <div class="card myBlock mt-3">
                <div class="card-body">
                    <ul class="list-unstyled">
                        {% if administrator %}
                            {% for item in administrator %}
                                <li>
                                    <input type="checkbox" class="form-check-input" id="{{ item.id }}" name="selected_admins[]" value="{{ item.id }},{{ item.company_number | upper }}-{{ item.name | upper }}">
                                    <label class="form-check-label" for="{{ item.id }}">
                                        <i class="fas fa-user me-2"></i>{{ item.company_number | upper }} - {{ item.name | upper }}
                                    </label>
                                </li>
                            {% endfor %}
                        {% else %}
                            <p><i class="fas fa-exclamation-circle me-2"></i>No Administrators Registered.</p>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <!-- Submit Button -->
            <button class="btn btn-success w-100 mt-3">
                <i class="fas fa-check-circle me-2"></i>Submit
            </button>
        </form>
    </div>
</div>

<script>
// Flash message timeout
setTimeout(() => {
    const flashMessage = document.getElementById("flash-message-container");
    if (flashMessage) {
        flashMessage.style.transition = "opacity 0.5s ease-out";
        flashMessage.style.opacity = "0";
        setTimeout(() => flashMessage.remove(), 500);
    }
}, 4000);

// Sidebar toggle script
document.addEventListener('DOMContentLoaded', function () {
    const toggleButton = document.getElementById('sidebarToggle');
    const sidebar = document.querySelector('.sidebar-content');

    if (toggleButton && sidebar) {
        toggleButton.addEventListener('click', function (e) {
            e.stopPropagation(); // Prevent document click
            sidebar.classList.toggle('active');
        });

        document.addEventListener('click', function (event) {
            if (!sidebar.contains(event.target) && event.target !== toggleButton) {
                sidebar.classList.remove('active');
            }
        });
    }
});
</script>

{% endblock %}